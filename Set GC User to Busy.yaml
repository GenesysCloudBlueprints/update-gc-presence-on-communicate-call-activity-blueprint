workflow:
  name: Set GC User to Busy
  division: Home
  startUpRef: "/workflow/states/state[Initial State_10]"
  defaultLanguage: en-us
  supportedLanguages:
    en-us:
      none: true
  variables:
    - stringVariable:
        name: Flow.conversationId
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - stringVariable:
        name: Flow.direction
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - stringVariable:
        name: Flow.id
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - stringVariable:
        name: Flow.participantId
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - stringVariable:
        name: Flow.userId
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
  settingsErrorHandling:
    errorHandling:
      endWorkflow:
        none: true
  states:
    - state:
        name: Initial State
        refId: Initial State_10
        variables:
          - stringVariable:
              name: State.GCUserPresence
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - integerVariable:
              name: State.PickUpCheck
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - stringCollectionVariable:
              name: State.purpose
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - stringCollectionVariable:
              name: State.segmentType
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - stringCollectionVariable:
              name: State.userId
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
        actions:
          - callData:
              name: Call Data Action
              timeout:
                lit:
                  minutes: 1
              category:
                Update Genesys Cloud User Presence:
                  dataAction:
                    Get Genesys Cloud User Presence:
                      inputs:
                        USER_ID:
                          exp: Flow.userId
                      successOutputs:
                        systemPresence:
                          var: State.GCUserPresence
                      failureOutputs:
                        errorCode:
                          noValue: true
                        status:
                          noValue: true
                        correlationId:
                          noValue: true
                        entityId:
                          noValue: true
                        entityName:
                          noValue: true
                        userMessage:
                          noValue: true
                        userParamsMessage:
                          noValue: true
                        userParams.key:
                          noValue: true
                        userParams.value:
                          noValue: true
                        details.errorCode:
                          noValue: true
                        details.fieldName:
                          noValue: true
                        details.entityId:
                          noValue: true
                        details.entityName:
                          noValue: true
              outputs:
                success:
                  actions:
                    - decision:
                        name: Decision
                        condition:
                          exp: If(State.GCUserPresence == "On Queue", true, false)
                        outputs:
                          "no":
                            actions:
                              - decision:
                                  name: Decision
                                  condition:
                                    exp: If(Flow.direction == "INBOUND", true, false)
                                  outputs:
                                    "yes":
                                      actions:
                                        - callData:
                                            name: Call Data Action
                                            timeout:
                                              lit:
                                                minutes: 1
                                            category:
                                              GetConversationDetailsPublicAPI:
                                                dataAction:
                                                  GetInboundConversationDetailsForPickUp (Includes Group Check) (ConversationDirect):
                                                    inputs:
                                                      CONVERSATION_ID:
                                                        exp: Flow.conversationId
                                                    successOutputs:
                                                      segmentType:
                                                        var: State.segmentType
                                                      purpose:
                                                        var: State.purpose
                                                    failureOutputs:
                                                      errorCode:
                                                        noValue: true
                                                      status:
                                                        noValue: true
                                                      correlationId:
                                                        noValue: true
                                                      entityId:
                                                        noValue: true
                                                      entityName:
                                                        noValue: true
                                                      userMessage:
                                                        noValue: true
                                                      userParamsMessage:
                                                        noValue: true
                                                      userParams.key:
                                                        noValue: true
                                                      userParams.value:
                                                        noValue: true
                                                      details.errorCode:
                                                        noValue: true
                                                      details.fieldName:
                                                        noValue: true
                                                      details.entityId:
                                                        noValue: true
                                                      details.entityName:
                                                        noValue: true
                                            outputs:
                                              success:
                                                actions:
                                                  - decision:
                                                      name: Decision
                                                      condition:
                                                        exp: "(If(toString(State.purpose) == \"group\", true, false))"
                                                      outputs:
                                                        "yes":
                                                          actions:
                                                            - loop:
                                                                name: Loop
                                                                currentIndex:
                                                                  var: State.PickUpCheck
                                                                loopCount:
                                                                  lit: 5
                                                                outputs:
                                                                  loop:
                                                                    actions:
                                                                      - wait:
                                                                          name: Wait
                                                                          trimDurationNearMaxRunningTime:
                                                                            lit: false
                                                                          duration:
                                                                            lit:
                                                                              seconds: 5
                                                                      - callData:
                                                                          name: Call Data Action
                                                                          timeout:
                                                                            lit:
                                                                              minutes: 1
                                                                          category:
                                                                            GetConversationDetailsPublicAPI:
                                                                              dataAction:
                                                                                GetInboundConversationCallsCheckForUserPickUp:
                                                                                  inputs:
                                                                                    CONVERSATION_ID:
                                                                                      exp: Flow.conversationId
                                                                                  successOutputs:
                                                                                    userId:
                                                                                      var: State.userId
                                                                                  failureOutputs:
                                                                                    errorCode:
                                                                                      noValue: true
                                                                                    status:
                                                                                      noValue: true
                                                                                    correlationId:
                                                                                      noValue: true
                                                                                    entityId:
                                                                                      noValue: true
                                                                                    entityName:
                                                                                      noValue: true
                                                                                    userMessage:
                                                                                      noValue: true
                                                                                    userParamsMessage:
                                                                                      noValue: true
                                                                                    userParams.key:
                                                                                      noValue: true
                                                                                    userParams.value:
                                                                                      noValue: true
                                                                                    details.errorCode:
                                                                                      noValue: true
                                                                                    details.fieldName:
                                                                                      noValue: true
                                                                                    details.entityId:
                                                                                      noValue: true
                                                                                    details.entityName:
                                                                                      noValue: true
                                                                          outputs:
                                                                            success:
                                                                              actions:
                                                                                - decision:
                                                                                    name: Decision
                                                                                    condition:
                                                                                      exp: "(If(toString(State.userId) == Flow.userId, true, false))"
                                                                                    outputs:
                                                                                      "yes":
                                                                                        actions:
                                                                                          - callData:
                                                                                              name: Call Data Action
                                                                                              timeout:
                                                                                                lit:
                                                                                                  minutes: 1
                                                                                              category:
                                                                                                Update Genesys Cloud User Presence:
                                                                                                  dataAction:
                                                                                                    GC User Presence Update:
                                                                                                      inputs:
                                                                                                        USER_ID:
                                                                                                          exp: Flow.userId
                                                                                                        PRESENCE_DEFINITION_ID:
                                                                                                          lit: 31fe3bac-dea6-44b7-bed7-47f91660a1a0
                                                                                                      failureOutputs:
                                                                                                        errorCode:
                                                                                                          noValue: true
                                                                                                        status:
                                                                                                          noValue: true
                                                                                                        correlationId:
                                                                                                          noValue: true
                                                                                                        entityId:
                                                                                                          noValue: true
                                                                                                        entityName:
                                                                                                          noValue: true
                                                                                                        userMessage:
                                                                                                          noValue: true
                                                                                                        userParamsMessage:
                                                                                                          noValue: true
                                                                                                        userParams.key:
                                                                                                          noValue: true
                                                                                                        userParams.value:
                                                                                                          noValue: true
                                                                                                        details.errorCode:
                                                                                                          noValue: true
                                                                                                        details.fieldName:
                                                                                                          noValue: true
                                                                                                        details.entityId:
                                                                                                          noValue: true
                                                                                                        details.entityName:
                                                                                                          noValue: true
                                                                                              outputs:
                                                                                                success:
                                                                                                  actions:
                                                                                                    - loopExit:
                                                                                                        name: Exit Loop
                                                        "no":
                                                          actions:
                                                            - loop:
                                                                name: Loop
                                                                currentIndex:
                                                                  var: State.PickUpCheck
                                                                loopCount:
                                                                  lit: 5
                                                                outputs:
                                                                  loop:
                                                                    actions:
                                                                      - wait:
                                                                          name: Wait
                                                                          trimDurationNearMaxRunningTime:
                                                                            lit: false
                                                                          duration:
                                                                            lit:
                                                                              seconds: 5
                                                                      - callData:
                                                                          name: Call Data Action
                                                                          category:
                                                                            GetConversationDetailsPublicAPI:
                                                                              dataAction:
                                                                                GetInboundConversationDetailsForPickUp (Includes Group Check) (ConversationDirect):
                                                                                  inputs:
                                                                                    CONVERSATION_ID:
                                                                                      exp: Flow.conversationId
                                                                                  successOutputs:
                                                                                    segmentType:
                                                                                      var: State.segmentType
                                                                                    purpose:
                                                                                      var: State.purpose
                                                                                  failureOutputs:
                                                                                    errorCode:
                                                                                      noValue: true
                                                                                    status:
                                                                                      noValue: true
                                                                                    correlationId:
                                                                                      noValue: true
                                                                                    entityId:
                                                                                      noValue: true
                                                                                    entityName:
                                                                                      noValue: true
                                                                                    userMessage:
                                                                                      noValue: true
                                                                                    userParamsMessage:
                                                                                      noValue: true
                                                                                    userParams.key:
                                                                                      noValue: true
                                                                                    userParams.value:
                                                                                      noValue: true
                                                                                    details.errorCode:
                                                                                      noValue: true
                                                                                    details.fieldName:
                                                                                      noValue: true
                                                                                    details.entityId:
                                                                                      noValue: true
                                                                                    details.entityName:
                                                                                      noValue: true
                                                                          outputs:
                                                                            success:
                                                                              actions:
                                                                                - decision:
                                                                                    name: Decision
                                                                                    condition:
                                                                                      exp: "(If(toString(State.segmentType) == \"Interact\", true, false))"
                                                                                    outputs:
                                                                                      "yes":
                                                                                        actions:
                                                                                          - callData:
                                                                                              name: Call Data Action
                                                                                              timeout:
                                                                                                lit:
                                                                                                  minutes: 1
                                                                                              category:
                                                                                                Update Genesys Cloud User Presence:
                                                                                                  dataAction:
                                                                                                    GC User Presence Update:
                                                                                                      inputs:
                                                                                                        USER_ID:
                                                                                                          exp: Flow.userId
                                                                                                        PRESENCE_DEFINITION_ID:
                                                                                                          lit: 31fe3bac-dea6-44b7-bed7-47f91660a1a0
                                                                                                      failureOutputs:
                                                                                                        errorCode:
                                                                                                          noValue: true
                                                                                                        status:
                                                                                                          noValue: true
                                                                                                        correlationId:
                                                                                                          noValue: true
                                                                                                        entityId:
                                                                                                          noValue: true
                                                                                                        entityName:
                                                                                                          noValue: true
                                                                                                        userMessage:
                                                                                                          noValue: true
                                                                                                        userParamsMessage:
                                                                                                          noValue: true
                                                                                                        userParams.key:
                                                                                                          noValue: true
                                                                                                        userParams.value:
                                                                                                          noValue: true
                                                                                                        details.errorCode:
                                                                                                          noValue: true
                                                                                                        details.fieldName:
                                                                                                          noValue: true
                                                                                                        details.entityId:
                                                                                                          noValue: true
                                                                                                        details.entityName:
                                                                                                          noValue: true
                                                                                              outputs:
                                                                                                success:
                                                                                                  actions:
                                                                                                    - loopExit:
                                                                                                        name: Exit Loop
                                    "no":
                                      actions:
                                        - loop:
                                            name: Loop
                                            currentIndex:
                                              var: State.PickUpCheck
                                            loopCount:
                                              lit: 5
                                            outputs:
                                              loop:
                                                actions:
                                                  - wait:
                                                      name: Wait
                                                      trimDurationNearMaxRunningTime:
                                                        lit: false
                                                      duration:
                                                        lit:
                                                          seconds: 5
                                                  - callData:
                                                      name: Call Data Action
                                                      timeout:
                                                        lit:
                                                          minutes: 1
                                                      category:
                                                        GetConversationDetailsPublicAPI:
                                                          dataAction:
                                                            GetOutboundConversationDetailsForPickUp (ConversationDirect):
                                                              inputs:
                                                                CONVERSATION_ID:
                                                                  exp: Flow.conversationId
                                                              successOutputs:
                                                                segmentType:
                                                                  var: State.segmentType
                                                              failureOutputs:
                                                                errorCode:
                                                                  noValue: true
                                                                status:
                                                                  noValue: true
                                                                correlationId:
                                                                  noValue: true
                                                                entityId:
                                                                  noValue: true
                                                                entityName:
                                                                  noValue: true
                                                                userMessage:
                                                                  noValue: true
                                                                userParamsMessage:
                                                                  noValue: true
                                                                userParams.key:
                                                                  noValue: true
                                                                userParams.value:
                                                                  noValue: true
                                                                details.errorCode:
                                                                  noValue: true
                                                                details.fieldName:
                                                                  noValue: true
                                                                details.entityId:
                                                                  noValue: true
                                                                details.entityName:
                                                                  noValue: true
                                                      outputs:
                                                        success:
                                                          actions:
                                                            - decision:
                                                                name: Decision
                                                                condition:
                                                                  exp: "(If(toString(State.segmentType) == \"Interact\", true, false))"
                                                                outputs:
                                                                  "yes":
                                                                    actions:
                                                                      - callData:
                                                                          name: Call Data Action
                                                                          timeout:
                                                                            lit:
                                                                              minutes: 1
                                                                          category:
                                                                            Update Genesys Cloud User Presence:
                                                                              dataAction:
                                                                                GC User Presence Update:
                                                                                  inputs:
                                                                                    USER_ID:
                                                                                      exp: Flow.userId
                                                                                    PRESENCE_DEFINITION_ID:
                                                                                      lit: 31fe3bac-dea6-44b7-bed7-47f91660a1a0
                                                                                  failureOutputs:
                                                                                    errorCode:
                                                                                      noValue: true
                                                                                    status:
                                                                                      noValue: true
                                                                                    correlationId:
                                                                                      noValue: true
                                                                                    entityId:
                                                                                      noValue: true
                                                                                    entityName:
                                                                                      noValue: true
                                                                                    userMessage:
                                                                                      noValue: true
                                                                                    userParamsMessage:
                                                                                      noValue: true
                                                                                    userParams.key:
                                                                                      noValue: true
                                                                                    userParams.value:
                                                                                      noValue: true
                                                                                    details.errorCode:
                                                                                      noValue: true
                                                                                    details.fieldName:
                                                                                      noValue: true
                                                                                    details.entityId:
                                                                                      noValue: true
                                                                                    details.entityName:
                                                                                      noValue: true
                                                                          outputs:
                                                                            success:
                                                                              actions:
                                                                                - loopExit:
                                                                                    name: Exit Loop
          - endWorkflow:
              name: End Workflow
              exitReason:
                noValue: true
